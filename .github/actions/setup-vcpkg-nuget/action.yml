name: "setup-vcpkg-nuget"
description: "Add vcpkg nuget feed"
inputs:
  package_permission:
    required: true
    description: "Whether to configure publish-capable credentials (true/false)"
  feed_url:
    required: true
    description: "NuGet feed URL"
  nuget_cmd:
    required: true
    description: "Path to nuget.exe"
  username:
    required: false
    description: "Username for the feed"
  packageaccess:
    required: false
    description: "Package feed API key (pass from workflow secrets when package_permission=true)"

runs:
  using: "composite"
  steps:
    - name: Add vcpkg nuget feed (consume-only)
      if: ${{ inputs.package_permission == 'false' }}
      shell: bash
      run: |
        ${{ inputs.nuget_cmd }} \
          sources add \
          -Source "${{ inputs.feed_url }}" \
          -StorePasswordInClearText \
          -Name GitHubPackages \

    - name: Configure vcpkg nuget credentials (publish only)
      if: ${{ inputs.package_permission == 'true' }}
      shell: bash
      run: |
        ${{ inputs.nuget_cmd }} \
          sources add \
          -Source "${{ inputs.feed_url }}" \
          -StorePasswordInClearText \
          -Name GitHubPackages \
          -UserName "${{ inputs.username }}" \
          -Password "${{ inputs.packageaccess }}"
        ${{ inputs.nuget_cmd }} \
        setapikey "${{ inputs.packageaccess }}" \
        -Source "${{ inputs.feed_url }}"
